<link rel="import" href="../../polymer/polymer.html">

<!--
The `concerto-content` elements provides a base element to be extended when
building specific Concerto content elements.

@element concerto-content
@status alpha
-->
<polymer-element name="concerto-content" attributes="contentId title">
  <template></template>

  <script>
    Polymer({
      /**
       * The `load` event is fired when the content is loaded and ready to be
       * displayed.  By default this happens in `domReady`.
       *
       * @event load
       */

      /**
       * Backend ID of the content.
       *
       * @attribute contentId
       * @type Number
       * @default 0
       */
       contentId: 0,

      /**
       * Title of the content.
       *
       * @attribute title
       * @type String
       * @default ''
       */
       title: '',

      /**
       * When the dom is ready, call `loaded` to say everything has loaded.
       */
      domReady: function() {
        this.loaded();
      },

      /**
       * Indicate that this content has finished loaded and can be displayed
       * in the field.
       *
       * Currently this involves firing the `load` event, but the details may
       * change.
       */
      loaded: function() {
        this.fire('load');
      },

      /**
       * Load the values from a JSON Map which map to attributes
       * of this element.
       */
      fromJSON: function(data) {
        Object.keys(data).forEach(function(key) {
          if (key in this) {
            this.setAttribute(key, data[key]);
          }
        }.bind(this));
      },
    });
  </script>
</polymer-element>
<script>
  /**
   * Register the content type described by the current page in the
   * ContentFactory.
   *
   * This method should be called from each piece of content which inherits from
   * concerto-content. It attempts to automatically determine what Polymer
   * element is being defined and setup an event listener to register it once
   * Polymer has finished loading all elements.
   */
  function registerContentType(){
    // Grab the current import document.
    var contentDocument = document.currentScript.ownerDocument;
    // Find the element being described.
    var elem = contentDocument.querySelector('polymer-element');
    window.addEventListener('polymer-ready', function(){
      if (concerto && concerto.contentFactory) {
        // concerto-ticker should be known as ticker.
        var name = elem.getAttribute('name').replace(/^concerto-/, '');
        var klass = elem.getAttribute('constructor');
        concerto.contentFactory.registerType(name, window[klass]);
      }
    });
  }
</script>
