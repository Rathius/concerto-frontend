<!--
  The `concerto-content` elements provides a base element to be extended when
  building specific Concerto content elements.
-->
<dom-module id="concerto-content" attributes="contentId title duration autoLoad baseURL cssText">
  <style>
    :host {
      position: absolute;
    }
  </style>
</dom-module>

<script>
  Polymer({
    is: "concerto-content",

    properties: {
      contentId: {
        type: Number,
        value: 0
      },
      title: {
        type: String,
        value: ''
      },
      duration: {
        type: Number,
        value: 0
      },
      autoLoad: {
        type: Boolean,
        value: true
      },
      cssText: {
        type: String,
        value: ''
      },
      baseURL: {
        type: String,
        value: ''
      }
    }

    /**
     * When the dom is ready, call `loaded` to say everything has loaded.
     */
    domReady: function() {
      if (this.autoLoad) {
        this.loaded();
      }
    },

    /**
     * Indicate that this content has finished loaded and can be displayed
     * in the field.
     *
     * Currently this involves firing the `load` event, but the details may
     * change.
     */
    loaded: function() {
      this.fire('load', this);
    },

    /**
     * Load the values from a JSON Map which map to attributes
     * of this element.
     */
    fromJSON: function(data) {
      Object.keys(data).forEach(function(key) {
        if (key in this) {
          if (typeof data[key] == 'object') {
            this.setAttribute(key, JSON.stringify(data[key]));
          } else {
            this.setAttribute(key, data[key]);
          }
        }
      }.bind(this));
      if (this.autoLoad) {
        this.loaded();
      }
    },

    /**
     * Apply the new cssText back to the element.
     *
     * Different content types should override this method to set the styl on
     * a more appropriate DOM element.
     */
    cssTextChanged: function() {
      this.style.cssText = this.cssText;
     },
  });
</script>
<script>
  /**
   * Register the content type described by the current page in the
   * ContentFactory.
   *
   * This method should be called from each piece of content which inherits from
   * concerto-content. It attempts to automatically determine what Polymer
   * element is being defined and setup an event listener to register it once
   * Polymer has finished loading all elements.
   */
  function registerContentType(contentName, klass){
    window.addEventListener('WebComponentsReady', function(){
      if (concerto && concerto.contentFactory) {
        // concerto-ticker should be known as ticker.
        var name = contentName.replace(/^concerto-/, '');
        concerto.contentFactory.registerType(name, window[klass]);
      }
    });
  }
</script>